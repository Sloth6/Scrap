$collectionOpenTransitionDuration: 1s;
$hideImageWhiteBorder: -2px -1px -4px -2px;

body {
  
    .collection {
        &.stack {
            @include cursorGrab;
        }
    }
        
    article {
        color: $colorType;
        position: absolute;
        backface-visibility: hidden;
        margin-right: -2pt;
        line-height: 1.5em;
        transform-origin: center center;
        -webkit-transform-origin: center center;
        -moz-transform-origin: center center;
        
        // EVENTS
        
        &.hover {
            @include cursorGrab;
            
            .articleControls {
                opacity: 1;
            }
        }

        &.dragging, &.ui-draggable-dragging, &.active, &:active {

            > .content .card {
                @include cardDragging;
            }
        }
        
        &.locked {
            opacity: .25;
            -webkit-filter: grayscale(1);
        }

        &.resizing {
            .card .ui-resizable-handle {
                opacity: .5;
            }
        }
                
        // CONTENTS
        
        .articleControls {
            @include transition(.25s $defaultCurve);
            @include transition-property(opacity);
            opacity: 0; 
            top: -20px;
            left: -$cell;
            right: $cell;
            position: absolute;
            z-index: 5000;
            font-style: normal;
            color: $colorType;
            
            .articleDeleteButton, author {
                @include linkReset;
                position: absolute;
                display: block;
                bottom: 0;
            }
            
            .articleDeleteButton {
                left: 0;
            }
            
            author {
                right:  0;
                white-collection: nowrap;
            }
        }
        
        // CONTENT
        
        &.text {
            font-style: normal;
            max-width: 50vh !important;
            
            .card {
                width: $articleSide;
                max-width: 50vh !important;
            }
            
            * {
                outline: none;
            }
            
            em {
                font-style: italic;
            }
            
            strong {
                font-weight: $fontWeightBold;
            }
            
            .editable {
                height: 100%;
                margin-bottom: $broadMargin;
                padding-left: $gutter * 2;
                padding-right: $gutter;
                @include typeBody;
                
                h1 {
//                     color: blue;
                    @include typeLarge;
                    margin-top: $typeBodyLeading;
                    
                    &:first-child {
                        margin-top: 0;
                    }
                }
                
                h2 {
//                     color: purple;
                    @include typeBodySmallCaps;
//                     margin-top: $typeBodyLeading / 2;
                    
                    &:first-child {
                        margin-top: $typeBodyLeading/2;
                    }
                }
                
                p + h2, ul + h2, ol + h2, blockquote + h2 {
                    margin-top: $typeBodyLeading;
                }
                
                div, p, ul, ol, span, blockquote, h1, h2 {
                    margin-bottom: $typeBodyLeading/2;
                }
                
                > p, > ul, > ol {
                    &:first-child {
                        margin-top: $typeBodyLeading/3;
                    }
                }
                
                div {
//                     background-color: magenta;
                }
                
                p {
//                     background: red;
                }
                
                blockquote {
                    border-left: 1px solid rgba(0,0,0,.25);
                    padding-left: $cell/1.5;
                    position: relative;
                    left: -$cell/1.5;
                    margin-left: -1px;
                    font-style: italic;
                }
                
                ul, ol {
                    position: relative;
//                     margin: 0;
//                     padding: 0;
                    
                    li {
                        &:before {
                            text-align: right;
//                             background: aqua;
                            position: absolute;
                            width: $gutter * 2;
                            left: -($gutter * 2) - $cardPaddingLeft/2;
                        }
//                         margin: 0;
//                         padding: 0;
                    }
                }
                
                ul {
//                     background: orange;
                    
                    li {
                        &:before {
                            content: 'â€“';
                        }
                    }
                }
                
                ol {
                    counter-reset: li;
//                     background: yellow;
                    
                    li {
                        &:before {
                            content:counter(li);
                            counter-increment:li;
                            @include typeBodySmallCaps;
                            margin-top: .225em;
                        }
                    }                    
                }
            }
        }
        
        &.image {
            
            .content {
                
                .card {
                    padding: 0px;
                    width: $articleSide;
                    max-height: $articleSideWide;
                    overflow: hidden;
                    
                    img {
                        margin: $hideImageWhiteBorder;
                    }
                }
            }
        }
        
        &.youtube {
            width: intrinsic;
            
            .content {
                
                .card {
                    max-width: $articleWidthVideo;
                    width: intrinsic;
                    padding: 0px;
                    
                    iframe {
                        margin: $hideImageWhiteBorder;
                    }
                }
            }
        }
        
        &.file .content {
            $foldWidth: 48px;
            position: relative;
            
            .fakeCard {
                @include cardStyle;
                height: $articleSide;
                width: $articleSideNarrow - $foldWidth - $cardPaddingRight;
                border-right: 0;
                position: relative;
            }
            
            .decorative.fold {
                z-index: 10;
                position: absolute;
                top: 0;
                right: 0;
                height: 100%;
                width: $foldWidth;
                background: transparent url('/images/fileCorner.png') no-repeat top right;
                background-size: $foldWidth $foldWidth;
                
                &:after {
                    content: " ";
                    left: -$cardBorderWidth;
                    right: 0;
                    top: $foldWidth;
                    position: absolute;
                    height: $articleSide - $foldWidth + $cell + $cardBorderWidth;
                    width: $foldWidth;
                    background: white;
                    border: $cardBorder;
                    border-left: 0;
                    border-top: 0;
                }
            }
            
            .card {
                width: $articleSideNarrow;
                // reset card style
                border: 0;
                background: transparent;
                padding: 0;
                
                header {
                    h1 {
                        word-wrap: break-word;
                    }
                }
                
            }
        }
        
        &.playable .card {
            width: $articleSide;
            padding: 0;
            position: relative;
            
            &.hover {
                
                .preview:after {
                    opacity: 1;
                    @include transform(scale(1)); 
                }
            }
            
            &:active {
                .preview:after {
                    -webkit-filter: invert(1);
                    @include transform(scale(.95)); 
                }
            }

            .preview {
                position: relative;
                cursor: pointer;
                
                &:after {
                    content: '';
                    background: url('/images/playButton.png') no-repeat;
                    background-size: cover;
                    height: 72px;
                    width:  72px;
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    margin-top: -36px;
                    margin-left: -36px;
                    z-index: 9000000;

                    opacity: 0;
                    @include transform(scale(0));
                    @include transition(.1825s $defaultCurve);
                    @include transition-property(opacity,
                                                 transform,
                                         -webkit-transform,
                                            -moz-transform);
                                            
                }                
            }
            
            header {
                border-top: 0;
                padding: $cardPadding;
                
                .artist {
                    margin-top: $cell/2;
                }
                
                .detail {
                    margin-top: $midMargin; 
                }
            }
        }
        
        .card {
            position: relative;
            overflow: hidden;
            min-height: $articleMinHeight;
            
            &.website {
                @include cardStyle;
                width: $articleSideNarrow;
                
                &.hover {
                    @include hoverLinkAnimation;
                    
                    .text {
                        
                        header {
                            
                            .url {
                                opacity: 1;
                            }
                        }
                    }
                }
                
                a {
                    border: 0;
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                }
                               
                .text {
                    overflow: visible;

                    header {
                        position: absolute;
                        top: $cell/2;
                        @include transition($collectionOpenTransitionDuration $defaultCurve);
                        @include transition-property(top);

                        h1 {
                            display: -webkit-box;
                            -webkit-line-clamp: 4;
                            -webkit-box-orient: vertical; 
                            max-height: $typeHeaderLeading * 4;
                            overflow: hidden;
                            padding-bottom: .125em;
                            margin-bottom: -.125em;
                        }
    
                        .url {
                            margin-top: $cell/2;
                            @include transition(.25s $defaultCurve);
                            @include transition-property(opacity);
                        }
                    }

                    .description {
                        margin-top: $articleSideNarrow - $col;
                        margin-bottom: $cell/2;
                        opacity: 1;
                        @include transition($collectionOpenTransitionDuration $defaultCurve);
                        @include transition-property(opacity, margin-top);
                    }
                    
                    img {
                        margin-top: 0;
                        @include transition($collectionOpenTransitionDuration $defaultCurve);
                        @include transition-property(margin-top);
                    }
                }
            }

            
            &.caption, &.comment {                       
                // background-color: $colorCardBackgroundLight;
            }
            
            h1.headerType {
                margin-left: $headerLeftMarginOffset;
                margin-top: -.15em;
            }

            img {
                width: 100%;
                margin-bottom: -$cell/3;
                background-color: $colorCardBackground;
            }
        }
    }
}

.addArticleForm {
    .card {
        width: $articleSideNarrow;
    }
}

.addProjectForm {
    &:hover, &.hover, &.editing, &.typing {
        h1.typeOutlineClear {
            @include typeOutlineFillBlack;
        }
    }
    
    .card {
        width: $coverWidth;
    }
}

.addArticleForm, .addProjectForm {
    // Compact view
    &.peek {
        &.onEdge {
            &:hover {
                .translate {
                  		@include transform(translate(-$col/2, 0px));
                }
            }
            
            &.slideInFromSide, &.slideInFromSide:hover {
                z-index: 99999999 !important;

                .translate {
                    		@include transform(translate(-$articleSideNarrow, 0px));
                    		
                    		.card .editable, .card .cardActions {
                    				opacity: 1;
                      		  @include transform(translate(0px, 0px));
                  		  }

                            		
                      &:after {
                        		@include transform(translate(-48px, 0px));
                      }
                }
                
                &.cover {
                
                    .translate, &.onEdge:hover .translate {
                        @include transform(translate(-$coverWidth, 0px));
                    }   
                }
            }
            
            .translate {                
              		.card .editable, .card .cardActions {
              				opacity: 0;
                		  @include transform(translate($articleSideNarrow, 0px));
            		  }
                
                &:after {
                  		@include transform(translate(0px, 0px));
                }
            }
        }

        .translate {
          		@include transform(translate(0px, 0px));
        		
            &:after {
              		@include transform(translate(-48px, 0px));
            }
        }
        
        .card .editable, .card .cardActions {
            opacity: 1;
            display: block;
          		@include transform(translate(0px, 0px));
            @include transition(1s $defaultCurve);
          		@include transition-property(opacity, transform,
          		                     -webkit-transform,
          		                        -moz-transform);
        }
    }
    
    &.typing, &.typing:hover {
        z-index: 99999999 !important;    
        
        .translate, .translate:hover {
            &:after {
                @include transform(translate(-48px, 0px));
            }
            
          		.card .editable, .card .cardActions {
              		opacity: 1;
          		  		@include transform(translate(0px, 0px));
          		}
        }
        
        .cardActions ul li {
            &.upload {
                opacity: 0;
            }
            
            &.done {
                opacity: 1;
            }
        }
    }
    
    .translate {
        overflow-x: hidden;
        position: relative;
        cursor: pointer;
        @include transform(translate(0px, 0px));
        @include transition(1s $defaultCurve);
        @include transition-property(transform,
                             -webkit-transform,
                                -moz-transform);

        // Plus sign for compact view
        &:after {
            content: "";
            height: 24px;
            width:  24px;
            font-weight: $fontWeightLight;
            background: url('/images/add.png') no-repeat;
            background-size: cover;
            position: absolute;
            left:    $cell*.75;
            top:  $cell*.75;
            //-webkit-transform-origin: center center;
            //        transform-origin: center center;
          		@include transform(translate(0px, 0px));
            @include transition(1s $defaultCurve);
            @include transition-property(transform,
                                 -webkit-transform,
                                    -moz-transform);
        }

        .card {
            overflow: visible;
                
            .cardActions {
                width: $articleSideNarrow;
                
                ul {
                    
                    li {

                        &.upload {
                            opacity: 1;
                            display: inline-block;
                            width: $col * 1.5;
                            height: $leading;
                            overflow: hidden;
                            position: relative;
                            
                            &:hover {
                                a {
                                    @include hoverLinkAnimation;
                                }
                            }
                            
                            form {
                                height: 100%;
                                width: 200%;
                                top: 0;
                                left: 0;
                                position: absolute;
                                
                                input {
                                    height: 100%;
                                    width: 100%;
                                    position: absolute;
                                    top: 0;
                                    left: -50%;
                                    opacity: 0;
                                    cursor: pointer !important;
                                }
                            }
                        }
                        
                        &.done {
                            display: inline-block;
                            height: $leading;
                            float: right;
                            width: intrinsic;
    
                            a {
                                border: 0;
                                padding: 0;
                                margin-left: $cell;
                            }
                        }
                    }
                }
            }
        }
    }               
}